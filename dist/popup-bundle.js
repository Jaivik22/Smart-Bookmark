import{d as v,a as m,s as B,b as F,g as T,c as x,e as I,f as P}from"./firebase-bundle.js";document.addEventListener("DOMContentLoaded",()=>{const i=document.getElementById("bookmarkTitle"),s=document.getElementById("sectionSelect"),d=document.getElementById("newSection"),L=document.getElementById("saveBookmark"),b=document.getElementById("bookmarkList"),k=document.getElementById("syncBtn"),y=document.getElementById("backArrow"),f=document.getElementById("bookmarkContainer"),E=document.getElementById("syncContainer");let c="";const D=window.browser||window.chrome,u="1234";D.tabs.query({active:!0,currentWindow:!0},t=>{if(t&&t[0]){c=t[0].url||"";const n=t[0].title||c||"Untitled";i.value=n,console.log("Fetched tab data:",{url:c,title:n})}else console.error("Failed to fetch active tab data:",t),i.value="Untitled",c=""});async function g(){try{const t=await T(x(m,"users",u,"topics")),n=[];t.forEach(e=>n.push(e.id)),s.innerHTML='<option value="">Select Section</option><option value="new">New Section...</option>',n.forEach(e=>{const o=document.createElement("option");o.value=e,o.textContent=e,s.appendChild(o)}),b.innerHTML="";for(const e of n){const o=await I(v(m,"users",u,"topics",e)),a=o.exists()?o.data().urls||[]:[],l=document.createElement("div");l.innerHTML=`<strong>${e}</strong>`,a.forEach((r,w)=>{if(!r||!r.url){console.warn("Invalid bookmark data:",r);return}const h=r.title||"Untitled Bookmark";console.log("Rendering bookmark:",{section:e,index:w,title:h,url:r.url});const p=document.createElement("div");p.className="bookmark-item",p.innerHTML=`
            <a href="${r.url}" target="_blank">${h}</a>
            <button class="delete-btn" data-section="${e}" data-index="${w}">Delete</button>`,l.appendChild(p)}),b.appendChild(l)}document.querySelectorAll(".delete-btn").forEach(e=>{e.addEventListener("click",o=>{const a=o.target.dataset.section,l=parseInt(o.target.dataset.index);S(a,l)})})}catch(t){console.error("Error loading data from Firebase:",t),alert("Failed to load bookmarks. Please try again.")}}async function S(t,n){try{const e=v(m,"users",u,"topics",t),o=await I(e);if(o.exists()){const a=o.data().urls||[];a.splice(n,1),a.length===0?await P(e):await B(e,{urls:a},{merge:!0}),g()}}catch(e){console.error("Error deleting bookmark:",e),alert("Failed to delete bookmark. Please try again.")}}s.addEventListener("change",()=>{d.style.display=s.value==="new"?"block":"none"});async function C(t,n,e){try{const o=v(m,"users",u,"topics",e);await B(o,{urls:F({title:t,url:n,date:new Date().toISOString()})},{merge:!0}),console.log("Bookmark saved successfully!"),i.value="",s.value="",d.value="",d.style.display="none",g()}catch(o){console.error("Error saving bookmark:",o),alert("Failed to save bookmark. Please try again.")}}L.addEventListener("click",()=>{const t=c,n=i.value.trim()||t||"Untitled";let e=s.value;if(!t||!e){alert("Please select a section");return}if(e==="new"&&(e=d.value.trim(),!e)){alert("Please enter a section name");return}console.log("created section: "+e),C(n,t,e)}),k.addEventListener("click",()=>{f.style.display="none",E.style.display="block",k.style.display="none",y.style.display="inline"}),y.addEventListener("click",()=>{E.style.display="none",f.style.display="block",k.style.display="flex",y.style.display="none"}),g()});
