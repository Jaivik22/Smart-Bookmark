import{d as v,a as m,s as I,b as T,g as U,c as x,e as L,f as M}from"./firebase-bundle.js";document.addEventListener("DOMContentLoaded",async()=>{const d=document.getElementById("bookmarkTitle"),c=document.getElementById("sectionSelect"),u=document.getElementById("newSection"),D=document.getElementById("saveBookmark"),f=document.getElementById("bookmarkList"),y=document.getElementById("syncBtn"),k=document.getElementById("backArrow"),E=document.getElementById("bookmarkContainer"),w=document.getElementById("syncContainer");let l="";const b=window.browser||window.chrome;let a="";try{a=(await new Promise(n=>{b.storage.sync.get("syncCode",n)})).syncCode,console.log("Usercode set to:",a)}catch(t){console.error("Error fetching sync code:",t)}b.tabs.query({active:!0,currentWindow:!0},t=>{if(t&&t[0]){l=t[0].url||"";const n=t[0].title||l||"Untitled";d.value=n,console.log("Fetched tab data:",{url:l,title:n})}else console.error("Failed to fetch active tab data:",t),d.value="Untitled",l=""});async function g(){try{const t=await U(x(m,"users",a,"topics")),n=[];t.forEach(e=>n.push(e.id)),c.innerHTML='<option value="">Select Section</option><option value="new">New Section...</option>',n.forEach(e=>{const o=document.createElement("option");o.value=e,o.textContent=e,c.appendChild(o)}),f.innerHTML="";for(const e of n){const o=await L(v(m,"users",a,"topics",e)),s=o.exists()?o.data().urls||[]:[],i=document.createElement("div");i.innerHTML=`<strong>${e}</strong>`,s.forEach((r,h)=>{if(!r||!r.url){console.warn("Invalid bookmark data:",r);return}const B=r.title||"Untitled Bookmark";console.log("Rendering bookmark:",{section:e,index:h,title:B,url:r.url});const p=document.createElement("div");p.className="bookmark-item",p.innerHTML=`
            <a href="${r.url}" target="_blank">${B}</a>
            <button class="delete-btn" data-section="${e}" data-index="${h}">Delete</button>`,i.appendChild(p)}),f.appendChild(i)}document.querySelectorAll(".delete-btn").forEach(e=>{e.addEventListener("click",o=>{const s=o.target.dataset.section,i=parseInt(o.target.dataset.index);C(s,i)})})}catch(t){console.error("Error loading data from Firebase:",t)}}async function C(t,n){try{const e=v(m,"users",a,"topics",t),o=await L(e);if(o.exists()){const s=o.data().urls||[];s.splice(n,1),s.length===0?await M(e):await I(e,{urls:s},{merge:!0}),g()}}catch(e){console.error("Error deleting bookmark:",e)}}c.addEventListener("change",()=>{u.style.display=c.value==="new"?"block":"none"});async function S(t,n,e){try{const o=v(m,"users",a,"topics",e);await I(o,{urls:T({title:t,url:n,date:new Date().toISOString()})},{merge:!0}),console.log("Bookmark saved successfully!"),d.value="",c.value="",u.value="",u.style.display="none",g()}catch(o){console.error("Error saving bookmark:",o)}}D.addEventListener("click",()=>{const t=l,n=d.value.trim()||t||"Untitled";let e=c.value;if(!t||!e){console.log("Please select a section");return}if(e==="new"&&(e=u.value.trim(),!e)){console.log("Please enter a section name");return}console.log("created section: "+e),S(n,t,e)}),y.addEventListener("click",()=>{E.style.display="none",w.style.display="block",y.style.display="none",k.style.display="inline"}),k.addEventListener("click",()=>{w.style.display="none",E.style.display="block",y.style.display="flex",k.style.display="none"}),g()});
